<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cottage Invitation</title>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;600;800&display=swap');

    :root {
      --hockey-bg: #0B1120;
      --hockey-card: #111827;
      --hockey-text: #E2E8F0;
      --hockey-accent: #B11226;
      --val-bg1: #ffd6e7;
      --val-bg2: #ffeef6;
      --val-card: #ffffffcc;
      --val-yes: #ff3b7a;
      --val-text: #1f2937;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100svh;
      display: grid;
      place-items: center;
      font-family: 'Inter', system-ui, sans-serif;

      overflow: hidden;

      padding: 20px;
      touch-action: manipulation;
      cursor: none;
      transition: background 1.5s ease-in-out;
      background:
        radial-gradient(circle at 20% 50%, rgba(31, 78, 216, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 30%, rgba(177, 18, 38, 0.1) 0%, transparent 40%),
        linear-gradient(180deg, #0B1120 0%, #0F172A 100%);
    }

    body.valentine-mode {
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), #fff5f8, var(--val-bg2), var(--val-bg1));
    }

    .cursor-heart {
      width: 34px;
      height: 34px;
      position: fixed;
      pointer-events: none;
      z-index: 10000;
      transform: translate(-50%, -50%);
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.2s ease;
      font-size: 34px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 4px 12px rgba(177, 18, 38, 0.65));
    }

    body.valentine-mode .cursor-heart {
      filter: drop-shadow(0 4px 12px rgba(255, 59, 122, 0.55));
      transform: translate(-50%, -50%) scale(1.08);
    }

    .cursor-heart.hovering {
      transform: translate(-50%, -50%) scale(1.5) !important;
      filter: drop-shadow(0 8px 25px rgba(255, 59, 122, 0.8)) !important;
    }

    @media (max-width: 768px) {
      .cursor-heart { width: 30px; height: 30px; font-size: 30px; }
    }

    .trail-dot {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      pointer-events: none;
      z-index: 9996;
      background: rgba(226, 232, 240, 0.45);
      transform: translate(-50%, -50%) scale(1);
      animation: trailFade 700ms ease-out forwards;
      filter: blur(0.2px);
    }
    body.valentine-mode .trail-dot {
      background: rgba(255, 59, 122, 0.28);
    }
    @keyframes trailFade {
      0% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
    }

    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }

    #paw-layer { position: fixed; inset: 0; pointer-events: none; z-index: 9992; }
    .pawprint {
      position: fixed;
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(var(--scale, 1));
      opacity: 0;
      font-size: 18px;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,0.35));
      animation: pawInOut 6.5s ease-out forwards;
      user-select: none;
      will-change: transform, opacity;
    }
    @keyframes pawInOut {
      0% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(var(--scale, 1)); }
      8% { opacity: 0.65; }
      100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(calc(var(--scale, 1) * 0.92)); }
    }

    .ice-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(200, 230, 255, 0.1);
      backdrop-filter: blur(2px);
    }
    .ice-overlay.active { opacity: 1; }

    .crack-svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .crack-path {
      fill: none;
      stroke: rgba(255, 255, 255, 0.9);
      stroke-width: 2;
      stroke-linecap: round;
      filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: crackDraw 2.6s ease-out forwards;
    }
    .crack-path.branch {
      stroke-width: 1.5;
      stroke: rgba(255, 255, 255, 0.7);
    }
    @keyframes crackDraw { to { stroke-dashoffset: 0; } }

    .shatter-piece {
      position: absolute;
      background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(200,220,255,0.2));
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,0.6);
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      opacity: 0;
      animation: shatterFall 2.8s ease-in forwards;
    }
    @keyframes shatterFall {
      0% { opacity: 1; transform: translate(0, 0) rotate(0deg) scale(1); }
      100% { opacity: 0; transform: translate(var(--tx), 100vh) rotate(var(--rot)) scale(0.5); }
    }

    .card {
      width: min(680px, 92vw);
      padding: clamp(32px, 6vw, 48px);
      border-radius: 4px;
      text-align: center;
      position: relative;
      z-index: 1;
      transform-style: preserve-3d;
      transform: perspective(1000px) rotateX(var(--rotateX, 0deg)) rotateY(var(--rotateY, 0deg));
      transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(177, 18, 38, 0.3);
      border-left: 4px solid var(--hockey-accent);
      box-shadow: 0 25px 80px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);

      max-height: calc(100svh - 40px);
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding-bottom: calc(clamp(32px, 6vw, 48px) + 26px);
    }

    body.valentine-mode .card {
      background: var(--val-card);
      border: 1px solid rgba(255,255,255,0.5);
      border-left: none;
      border-radius: 28px;
      box-shadow: 0 20px 70px rgba(0,0,0,.12);
    }

    .ice-texture {
      position: absolute;
      inset: 0;
      opacity: 0.03;
      background-image:
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255,255,255,0.1) 50px, rgba(255,255,255,0.1) 51px),
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(255,255,255,0.1) 50px, rgba(255,255,255,0.1) 51px);
      pointer-events: none;
      transition: opacity 1s ease;
    }
    body.valentine-mode .ice-texture { opacity: 0; }

    .hockey-decoration {
      position: absolute;
      top: 24px;
      right: 24px;
      opacity: 0.4;
      transition: all 0.8s ease;
      pointer-events: none;
      font-size: 48px;
      filter: grayscale(100%) brightness(1.5);
    }
    body.valentine-mode .hockey-decoration {
      opacity: 0;
      transform: translateY(-20px) rotate(20deg);
    }

    .hud {
      position: fixed;
      left: 18px;
      top: 18px;
      z-index: 9995;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.65);
      border: 1px solid rgba(177, 18, 38, 0.25);
      color: rgba(226, 232, 240, 0.92);
      backdrop-filter: blur(10px);
      font-size: 13px;
      letter-spacing: 0.02em;
      user-select: none;
    }
    body.valentine-mode .hud { display: none; }

    .hud .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(255,255,255,0.08);
    }

    #cheese-layer { position: fixed; inset: 0; z-index: 9994; pointer-events: none; }
    .cheese {
      position: absolute;
      font-size: 34px;
      line-height: 1;
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(0.95);
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
      user-select: none;
      pointer-events: auto;
      opacity: 0;
      animation: cheeseIn 380ms ease-out forwards;
      cursor: pointer;
    }
    @keyframes cheeseIn {
      to { opacity: 1; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1); }
    }
    .cheese.pop { animation: cheesePop 260ms ease-in forwards; }
    @keyframes cheesePop {
      0% { opacity: 1; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1.6); }
    }

    .art-container {
      position: relative;
      width: min(220px, 55vw);
      height: min(180px, 45vw);
      margin: 0 auto 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.8s ease;
      user-select: none;
    }
    body.valentine-mode .art-container { transform: scale(1.15); }

    .art {
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s ease forwards;
      transition: all 0.5s ease;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
    }
    body.valentine-mode .art { filter: drop-shadow(0 15px 30px rgba(255,59,122,0.25)); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    .text-container {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 24px 0;
      position: relative;
      transform: translateZ(20px);
      transition: all 0.8s ease;
    }

    .quote-text {
      font-family: 'Crimson Text', Georgia, serif;
      font-size: clamp(18px, 4vw, 26px);
      line-height: 1.7;
      color: var(--hockey-text);
      font-style: italic;
      max-width: 580px;
      text-align: left;
      position: relative;
      padding: 0 24px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      letter-spacing: 0.02em;
    }
    .quote-text::before {
      content: '"';
      font-size: 80px;
      color: var(--hockey-accent);
      position: absolute;
      top: -30px;
      left: -10px;
      opacity: 0.4;
      font-family: Georgia, serif;
    }
    body.valentine-mode .quote-text { display: none; }

    h1 {
      font-size: clamp(26px, 6vw, 42px);
      margin: 0;
      line-height: 1.2;
      font-weight: 800;
      letter-spacing: -0.02em;
      position: relative;
      display: none;
      color: var(--val-text);
      transition: all 0.8s ease;
    }
    h1.valentine-mode {
      display: block;
      color: var(--val-yes);
      text-shadow: 0 2px 20px rgba(255, 59, 122, 0.2);
      animation: heartbeat 1.8s ease-in-out infinite;
      font-family: 'Inter', sans-serif;
    }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    .scramble-text { font-family: 'Courier New', monospace; }

    .cursor {
      display: inline-block;
      width: 3px;
      height: 0.9em;
      background: var(--val-yes);
      margin-left: 4px;
      animation: blink 1.2s infinite;
      vertical-align: baseline;
    }
    @keyframes blink {
      0%, 45% { opacity: 1; }
      50%, 95% { opacity: 0; }
    }

    .subtitle {
      font-size: 13px;
      color: #64748B;
      margin-top: 24px;
      text-transform: uppercase;
      letter-spacing: 4px;
      font-weight: 600;
      transition: all 0.5s ease;
      font-family: 'Inter', sans-serif;
      user-select: none;
    }
    .subtitle::before { content: '‚Äî '; color: var(--hockey-accent); }

    body.valentine-mode .subtitle {
      color: #6b7280;
      text-transform: none;
      letter-spacing: 0.5px;
      font-weight: 500;
    }
    body.valentine-mode .subtitle::before { content: none; }

    .button-zone {
      position: relative;
      width: 100%;
      height: min(180px, 30vh);
      margin: 32px auto 12px;
      user-select: none;
      opacity: 0;
      pointer-events: none;
      transform: scale(0.9) translateY(20px);
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      touch-action: none;
    }
    .button-zone.active {
      opacity: 1;
      pointer-events: all;
      transform: scale(1) translateY(0);
    }

    .yes-container {
      position: absolute;
      left: 15%;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    #yesBtn {
      position: relative;
      padding: 22px 44px;
      font-size: clamp(18px, 4vw, 24px);
      font-weight: 800;
      border-radius: 999px;
      border: none;
      cursor: none;
      background: var(--val-yes);
      color: #fff;
      box-shadow: 0 10px 30px rgba(255, 59, 122, 0.3);
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.25s ease, background 0.25s ease;
      min-width: 130px;
      min-height: 66px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transform: scale(var(--current-scale, 1.15));
      touch-action: none;
    }

    #yesBtn.glow-1 { box-shadow: 0 12px 35px rgba(255, 59, 122, 0.35); }
    #yesBtn.glow-2 { box-shadow: 0 14px 40px rgba(255, 59, 122, 0.4); }
    #yesBtn.glow-3 { box-shadow: 0 16px 45px rgba(255, 59, 122, 0.45), 0 0 40px rgba(255, 59, 122, 0.1); }
    #yesBtn.glow-4 { box-shadow: 0 18px 50px rgba(255, 59, 122, 0.5), 0 0 60px rgba(255, 59, 122, 0.15); }
    #yesBtn.glow-5 {
      box-shadow: 0 20px 55px rgba(255, 59, 122, 0.55), 0 0 80px rgba(255, 59, 122, 0.2);
      animation: yesPulse 2s ease-in-out infinite;
    }
    @keyframes yesPulse {
      0%, 100% { transform: scale(var(--current-scale, 1.15)); }
      50% { transform: scale(calc(var(--current-scale, 1.15) * 1.02)); }
    }

    .pulse-ring {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255, 59, 122, 0.5);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
    }
    @keyframes ringExpand {
      0% { width: 100%; height: 100%; opacity: 0.5; }
      100% { width: 180%; height: 180%; opacity: 0; }
    }

    .yes-microtext {
      font-size: 11px;
      color: var(--val-yes);
      opacity: 0;
      transform: translateY(-5px);
      transition: all 0.5s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
      font-style: italic;
      white-space: nowrap;
      margin-top: 4px;
      user-select: none;
    }
    .yes-microtext.visible { opacity: 0.9; transform: translateY(0); }

    #noBtn {
      position: absolute;
      left: 65%;
      top: 50%;
      transform: translate(-50%, -50%);
      padding: 18px 36px;
      font-size: clamp(16px, 3.5vw, 20px);
      font-weight: 700;
      border-radius: 999px;
      border: none;
      cursor: none;
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      color: #334155;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: transform 0.18s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.35s ease, filter 0.35s ease;
      z-index: 20;
      touch-action: none;
      will-change: left, top, transform, opacity, filter;
    }

    #noBtn.fade-1 { opacity: 0.82; filter: blur(0.3px); }
    #noBtn.fade-2 { opacity: 0.64; filter: blur(0.8px); }
    #noBtn.fade-3 { opacity: 0.46; filter: blur(1.2px); }
    #noBtn.fade-4 { opacity: 0.28; filter: blur(1.8px); }
    #noBtn.vanish { opacity: 0; filter: blur(2.6px); pointer-events: none; transform: translate(-50%, -50%) scale(0.6) rotate(-12deg); }

    /* Mobile: Yes bigger, centered, more focus */
    @media (max-width: 520px) {
      .button-zone { height: 220px; margin-top: 26px; }
      .yes-container {
        left: 50% !important;
        top: 25% !important;
        transform: translate(-50%, -50%);
      }
      #yesBtn {
        padding: 24px 56px;
        min-width: 190px;
        min-height: 74px;
        font-size: 22px;
        box-shadow: 0 18px 55px rgba(255, 59, 122, 0.45), 0 0 60px rgba(255, 59, 122, 0.12);
      }
      #noBtn {
        left: 50% !important;
        top: 78% !important;
        transform: translate(-50%, -50%);
      }
    }

    .hint {
      margin-top: 20px;
      font-size: 14px;
      opacity: 0;
      color: #64748b;
      font-weight: 500;
      transition: opacity 0.5s ease 0.3s;
      font-style: italic;
      user-select: none;
    }
    body.valentine-mode .hint { color: #6b7280; }
    .hint.visible { opacity: 0.85; }

    .result {
      display: none;
      margin-top: 20px;
      animation: pop .5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      text-align: center;
      width: 100%;
      padding-bottom: 26px;
    }
    .result h2 {
      font-size: clamp(28px, 7vw, 48px);
      margin: 0 0 20px 0;
      background: linear-gradient(135deg, var(--val-yes), #ff6b9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }
    .fireworks {
      width: min(320px, 85vw);
      max-height: 240px;
      object-fit: contain;
      margin: 0 auto 20px auto;
      display: block;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .russian-text {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
      font-family: 'Inter', sans-serif;
      margin-top: 8px;
      opacity: 0.9;
      letter-spacing: 0.02em;
    }

    @keyframes pop {
      from { transform: scale(0.8) translateY(30px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .particle {
      position: fixed;
      pointer-events: none;
      opacity: 0.6;
      z-index: 9997;
      animation: float 3s ease-out forwards;
      font-size: 22px;
    }
    @keyframes float {
      0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 0.6; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(360deg); opacity: 0; }
    }

    .no-spark {
      position: fixed;
      pointer-events: none;
      z-index: 9997;
      font-size: 18px;
      opacity: 0.85;
      animation: noSpark 700ms ease-out forwards;
      transform: translate(-50%, -50%);
    }
    @keyframes noSpark {
      0% { opacity: 0.85; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0.2); }
    }
  </style>
</head>

<body>
  <div class="ice-overlay" id="iceOverlay">
    <svg class="crack-svg" id="crackSvg" preserveAspectRatio="none"></svg>
  </div>
  <canvas id="confettiCanvas"></canvas>

  <div class="hud" id="hud">
    <span class="chip">üßÄ <span id="cheeseCount">0</span>/5</span>
    <span id="hudText">Collect the cheese to unlock the next screen.</span>
  </div>

  <div class="cursor-heart" id="cursor">üê≠</div>
  <div id="trail-container"></div>
  <div id="paw-layer"></div>
  <div id="cheese-layer"></div>

  <main class="card" id="card">
    <div class="ice-texture"></div>
    <div class="hockey-decoration">üèí</div>

    <div class="art-container" id="catClickArea">
      <svg class="art" viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg" id="catSvg">
        <defs>
          <linearGradient id="fur" x1="0" x2="1">
            <stop offset="0" stop-color="#f7c7a1"/>
            <stop offset="1" stop-color="#f2a97b"/>
          </linearGradient>
          <linearGradient id="heart" x1="0" x2="1">
            <stop offset="0" stop-color="#ff4d7d"/>
            <stop offset="1" stop-color="#ff1f68"/>
          </linearGradient>
        </defs>

        <path d="M250 50 C250 33 270 25 282 38 C294 25 314 33 314 50 C314 78 282 92 282 106 C282 92 250 78 250 50Z"
              fill="url(#heart)" id="topHeart" opacity="0" style="transition: opacity 1s ease"/>

        <path d="M90 120 C90 70 140 40 190 60 C240 40 290 70 290 120 C290 180 240 210 190 210 C140 210 90 180 90 120Z"
              fill="url(#fur)"/>

        <path d="M110 92 L95 55 L140 78 Z" fill="#f2a97b"/>
        <path d="M270 92 L285 55 L240 78 Z" fill="#f2a97b"/>

        <g class="eye-group">
          <circle cx="155" cy="125" r="17" fill="#1f2937"/>
          <circle class="eye-pupil" id="eyeLeft" cx="158" cy="122" r="6" fill="white"/>
          <circle cx="161" cy="119" r="3" fill="white" opacity="0.9"/>

          <circle cx="225" cy="125" r="17" fill="#1f2937"/>
          <circle class="eye-pupil" id="eyeRight" cx="228" cy="122" r="6" fill="white"/>
          <circle cx="231" cy="119" r="3" fill="white" opacity="0.9"/>
        </g>

        <ellipse cx="125" cy="148" rx="15" ry="10" fill="#ff7aa2" opacity="0" id="blushLeft" style="transition: opacity 1s ease"/>
        <ellipse cx="255" cy="148" rx="15" ry="10" fill="#ff7aa2" opacity="0" id="blushRight" style="transition: opacity 1s ease"/>

        <path d="M190 144 C186 144 182 148 182 152 C182 160 190 164 190 170 C190 164 198 160 198 152 C198 148 194 144 190 144Z"
              fill="#ff7aa2"/>

        <line x1="140" y1="150" x2="105" y2="142" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="140" y1="156" x2="102" y2="156" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="140" y1="162" x2="105" y2="170" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>

        <line x1="240" y1="150" x2="275" y2="142" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="240" y1="156" x2="278" y2="156" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="240" y1="162" x2="275" y2="170" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
      </svg>
    </div>

    <div class="text-container">
      <div class="quote-text" id="hockeyText">
        Will you come to my cottage this summer? Don't go to Russia. Come to my house. We'll have so much fun. It's private. No one will know. We could have a week, or even two. We'll be completely alone. Together.
      </div>

      <h1 id="mainText" class="scramble-text" style="display: none;">
        Sandra, will you be my valentine?<span class="cursor"></span>
      </h1>

      <p class="subtitle" id="subtitle">Shane &amp; Ilya</p>
    </div>

    <section class="button-zone" id="zone">
      <div class="yes-container" id="yesContainer">
        <button id="yesBtn" type="button">Yes</button>
        <span class="yes-microtext" id="yesMicrotext">you know you want to</span>
      </div>
      <button id="noBtn" type="button">No</button>
    </section>

    <div class="hint" id="hint">"No" is feeling shy, try to catch it.</div>

    <section class="result" id="result">
      <h2>YAY!</h2>
      <img class="fireworks" src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExNXV2cHJ6Nnk0YjBub2Jua3BwZ21uZjNvOWRkd2JhaWYyeWN2eHR2cCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HJibfnd7xqk5hAMD4v/giphy.gif" alt="Celebration" loading="lazy"/>
      <p class="russian-text">–£—Ä–∞! –°–ø–∞—Å–∏–±–æ :) –Ø —Å–∞–º—ã–π —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –º–∏—Ä–µ</p>
    </section>
  </main>

  <script>
    let isValentineMode = false;
    let transitionDone = false;

    const isTouchDevice = (('ontouchstart' in window) || (navigator.maxTouchPoints > 0));
    const isSmallScreen = window.matchMedia('(max-width: 520px)').matches;
    const isMobileLike = isTouchDevice || isSmallScreen;

    let yesGrowthLevel = 0;
    const YES_BASE_SCALE = isMobileLike ? 1.32 : 1.15;  // bigger on mobile
    const YES_MAX_SCALE  = isMobileLike ? 2.9  : 2.6;
    const YES_GROW_STEP  = isMobileLike ? 0.14 : 0.11;
    let yesScale = YES_BASE_SCALE;

    // EXACT REQUIREMENT: No can be pressed 5 times, then it vanishes
    let noPresses = 0;
    const NO_VANISH_AT = 5;
    let noHidden = false;

    const body = document.body;
    const cursor = document.getElementById('cursor');
    const card = document.getElementById('card');

    const yesBtn = document.getElementById('yesBtn');
    const yesContainer = document.getElementById('yesContainer');
    const yesMicrotext = document.getElementById('yesMicrotext');

    const zone = document.getElementById('zone');
    const noBtn = document.getElementById('noBtn');
    const result = document.getElementById('result');
    const hint = document.getElementById('hint');

    const cheeseLayer = document.getElementById('cheese-layer');
    const hud = document.getElementById('hud');
    const cheeseCountEl = document.getElementById('cheeseCount');
    const hudText = document.getElementById('hudText');

    const pawLayer = document.getElementById('paw-layer');

    const confettiCanvas = document.getElementById('confettiCanvas');
    const myConfetti = confetti.create(confettiCanvas, { resize: true });

    const catClickArea = document.getElementById('catClickArea');
    let catClickCount = 0;

    const CAT_EMOJIS = ['‚ú®','üê≠','ü¶Å','üíï','üíñ'];
    const EMOJI_SCALAR = 1.6;
    const EMOJI_FONT = '"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif';

    const CAT_SHAPES = CAT_EMOJIS.map(e =>
      confetti.shapeFromText({ text: e, scalar: EMOJI_SCALAR, fontFamily: EMOJI_FONT })
    );

    function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }
    function rand(min, max) { return Math.random() * (max - min) + min; }

    function burstCatConfetti(clientX, clientY) {
      catClickCount++;

      const particleCount = Math.min(40 + catClickCount * 18, 280);
      const spread = Math.min(70 + catClickCount * 3, 140);
      const startVelocity = Math.min(35 + catClickCount * 1.2, 55);

      const ox = clamp(clientX / window.innerWidth, 0.05, 0.95);
      const oy = clamp(clientY / window.innerHeight, 0.05, 0.95);

      myConfetti({
        particleCount,
        spread,
        startVelocity,
        ticks: 220,
        gravity: 0.85,
        origin: { x: ox, y: oy },
        shapes: CAT_SHAPES,
        scalar: EMOJI_SCALAR
      });

      if (navigator.vibrate) navigator.vibrate(25);
    }

    if (catClickArea) {
      catClickArea.style.cursor = 'pointer';
      catClickArea.addEventListener('click', (e) => burstCatConfetti(e.clientX, e.clientY));
      catClickArea.addEventListener('touchstart', (e) => {
        if (!e.touches || !e.touches[0]) return;
        const t = e.touches[0];
        burstCatConfetti(t.clientX, t.clientY);
      }, { passive: true });
    }

    let mouseX = window.innerWidth / 2, mouseY = window.innerHeight / 2;
    let cursorX = mouseX, cursorY = mouseY;

    const sacc = {
      x: 0, y: 0,
      tx: 0, ty: 0,
      nextRetarget: 0,
      impulseX: 0, impulseY: 0,
      impulseUntil: 0,
      nextImpulse: 0
    };

    let cheeseCollected = 0;
    const CHEESE_TOTAL = 5;
    let cheeseUnlocked = false;

    let lastTrailX = cursorX, lastTrailY = cursorY, lastTrailTs = 0;

    let lastPawX = cursorX, lastPawY = cursorY;
    let lastMoveAngle = 0;

    // Track last finger position so "No" can dodge on mobile even without pointermove
    let lastPointerX = window.innerWidth / 2;
    let lastPointerY = window.innerHeight / 2;
    let pointerActive = false;

    function setTarget(x, y) {
      mouseX = x;
      mouseY = y;
      lastPointerX = x;
      lastPointerY = y;
      pointerActive = true;
    }

    document.addEventListener('mousemove', (e) => {
      setTarget(e.clientX, e.clientY);

      if (isValentineMode) {
        body.style.setProperty('--mouse-x', (mouseX / window.innerWidth * 100) + '%');
        body.style.setProperty('--mouse-y', (mouseY / window.innerHeight * 100) + '%');

        const rect = card.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        const rotateX = ((mouseY - centerY) / (window.innerHeight / 2)) * -3;
        const rotateY = ((mouseX - centerX) / (window.innerWidth / 2)) * 3;
        card.style.setProperty('--rotateX', rotateX + 'deg');
        card.style.setProperty('--rotateY', rotateY + 'deg');

        if (Math.random() > 0.92) spawnParticle(mouseX, mouseY);
      }
    }, { passive: true });

    document.addEventListener('touchstart', (e) => {
      if (!e.touches[0]) return;
      const t = e.touches[0];
      setTarget(t.clientX, t.clientY);
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (!e.touches[0]) return;
      const t = e.touches[0];
      setTarget(t.clientX, t.clientY);

      if (isValentineMode && Math.random() > 0.85) spawnParticle(t.clientX, t.clientY);
    }, { passive: true });

    function spawnTrailDot(x, y) {
      const dot = document.createElement('div');
      dot.className = 'trail-dot';
      dot.style.left = x + 'px';
      dot.style.top = y + 'px';
      document.getElementById('trail-container').appendChild(dot);
      setTimeout(() => dot.remove(), 800);
    }

    function updateSaccades(now) {
      if (now >= sacc.nextRetarget) {
        sacc.tx = rand(-2.0, 2.0);
        sacc.ty = rand(-1.8, 1.8);
        sacc.nextRetarget = now + rand(120, 260);
      }

      if (now >= sacc.nextImpulse) {
        sacc.impulseX = rand(-3.8, 3.8);
        sacc.impulseY = rand(-3.0, 3.0);
        sacc.impulseUntil = now + rand(45, 85);
        sacc.nextImpulse = now + rand(900, 2400);
      }

      sacc.x += (sacc.tx - sacc.x) * 0.18;
      sacc.y += (sacc.ty - sacc.y) * 0.18;

      if (now > sacc.impulseUntil) {
        sacc.impulseX *= 0.80;
        sacc.impulseY *= 0.80;
        if (Math.abs(sacc.impulseX) < 0.05) sacc.impulseX = 0;
        if (Math.abs(sacc.impulseY) < 0.05) sacc.impulseY = 0;
      } else {
        sacc.impulseX *= 0.88;
        sacc.impulseY *= 0.88;
      }
    }

    function spawnPawprint(x, y, angleRad) {
      if (!pawLayer || isValentineMode) return;

      const p = document.createElement('div');
      p.className = 'pawprint';
      p.textContent = 'üêæ';
      p.style.left = x + 'px';
      p.style.top = y + 'px';

      const deg = (angleRad * 180 / Math.PI) + rand(-10, 10);
      p.style.setProperty('--rot', deg.toFixed(1) + 'deg');
      p.style.setProperty('--scale', rand(0.92, 1.08).toFixed(2));

      pawLayer.appendChild(p);
      setTimeout(() => p.remove(), 7000);
    }

    function animateCursor() {
      const now = performance.now();

      const prevX = cursorX;
      const prevY = cursorY;

      cursorX += (mouseX - cursorX) * 0.15;
      cursorY += (mouseY - cursorY) * 0.15;

      cursor.style.left = cursorX + 'px';
      cursor.style.top = cursorY + 'px';

      const vx = cursorX - prevX;
      const vy = cursorY - prevY;
      if (Math.hypot(vx, vy) > 0.5) lastMoveAngle = Math.atan2(vy, vx);

      if (!isValentineMode) {
        const dp = Math.hypot(cursorX - lastPawX, cursorY - lastPawY);
        if (dp >= 35) {
          spawnPawprint(cursorX, cursorY, lastMoveAngle);
          lastPawX = cursorX;
          lastPawY = cursorY;
        }
      }

      updateSaccades(now);

      const lookX = cursorX + sacc.x + sacc.impulseX;
      const lookY = cursorY + sacc.y + sacc.impulseY;
      updateEye('eyeLeft', 155, 125, 5, lookX, lookY);
      updateEye('eyeRight', 225, 125, 5, lookX, lookY);

      const d = Math.hypot(cursorX - lastTrailX, cursorY - lastTrailY);
      if (d > 10 || (now - lastTrailTs) > 80) {
        spawnTrailDot(cursorX, cursorY);
        lastTrailX = cursorX;
        lastTrailY = cursorY;
        lastTrailTs = now;
      }

      requestAnimationFrame(animateCursor);
    }
    animateCursor();

    function updateEye(id, cx, cy, maxOff, tx, ty) {
      const eye = document.getElementById(id);
      const svg = document.getElementById('catSvg');
      if (!eye || !svg) return;

      const rect = svg.getBoundingClientRect();
      const eyeX = rect.left + (cx / 320) * rect.width;
      const eyeY = rect.top + (cy / 240) * rect.height;

      const angle = Math.atan2(ty - eyeY, tx - eyeX);
      const dist = Math.min(maxOff, Math.hypot(tx - eyeX, ty - eyeY) / 15);

      eye.setAttribute('cx', cx + Math.cos(angle) * dist);
      eye.setAttribute('cy', cy + Math.sin(angle) * dist);
    }

    function spawnParticle(x, y) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.textContent = ['‚ô•', '‚ú¶', '+', '‚Ä¢'][Math.floor(Math.random() * 4)];
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      p.style.setProperty('--tx', (Math.random() * 100 - 50) + 'px');
      p.style.setProperty('--ty', (Math.random() * -100 - 50) + 'px');
      document.getElementById('trail-container').appendChild(p);
      setTimeout(() => p.remove(), 3000);
    }

    function clearCheese() {
      if (!cheeseLayer) return;
      cheeseLayer.innerHTML = '';
    }

    function spawnCheesePieces() {
      if (!cheeseLayer) return;
      clearCheese();

      cheeseCollected = 0;
      cheeseUnlocked = false;
      cheeseCountEl.textContent = '0';
      hudText.textContent = 'Collect the cheese to unlock the next screen.';

      const pad = 56;
      for (let i = 0; i < CHEESE_TOTAL; i++) {
        const el = document.createElement('div');
        el.className = 'cheese';
        el.textContent = 'üßÄ';

        const x = rand(pad, window.innerWidth - pad);
        const y = rand(pad, window.innerHeight - pad);
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.setProperty('--rot', rand(-25, 25) + 'deg');

        el.addEventListener('click', () => collectCheese(el));
        el.addEventListener('touchstart', (e) => { e.preventDefault(); collectCheese(el); }, { passive: false });

        cheeseLayer.appendChild(el);
      }
    }

    function collectCheese(el) {
      if (!el || el.classList.contains('pop') || cheeseUnlocked) return;

      el.classList.add('pop');
      setTimeout(() => el.remove(), 300);

      cheeseCollected++;
      cheeseCountEl.textContent = String(cheeseCollected);

      if (cheeseCollected >= CHEESE_TOTAL) {
        cheeseUnlocked = true;
        hudText.textContent = 'Unlocked. Transitioning...';
        setTimeout(() => startTransition(), 450);
      }
    }

    function createIceCrack() {
      const overlay = document.getElementById('iceOverlay');
      const svg = document.getElementById('crackSvg');

      svg.innerHTML = '';
      overlay.querySelectorAll('.shatter-piece').forEach(el => el.remove());
      overlay.classList.add('active');

      const w = window.innerWidth;
      const h = window.innerHeight;
      const centerX = w / 2;
      const centerY = h / 2;

      const cracks = [
        `M ${centerX} ${centerY} L ${centerX + 200} ${centerY - 150} L ${centerX + 350} ${centerY - 180}`,
        `M ${centerX} ${centerY} L ${centerX - 180} ${centerY - 200} L ${centerX - 300} ${centerY - 250}`,
        `M ${centerX} ${centerY} L ${centerX + 100} ${centerY + 200} L ${centerX + 150} ${centerY + 350}`,
        `M ${centerX} ${centerY} L ${centerX - 220} ${centerY + 100} L ${centerX - 400} ${centerY + 150}`,
        `M ${centerX} ${centerY} L ${centerX + 50} ${centerY - 300} L ${centerX + 80} ${centerY - 450}`,
      ];

      cracks.forEach((d, i) => {
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', d);
        path.setAttribute('class', 'crack-path');
        path.style.animationDelay = (i * 0.22) + 's';
        svg.appendChild(path);

        if (Math.random() > 0.3) {
          const branch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          const midX = centerX + (Math.random() * 200 - 100);
          const midY = centerY + (Math.random() * 200 - 100);
          branch.setAttribute('d', `M ${midX} ${midY} L ${midX + (Math.random() * 120 - 60)} ${midY + (Math.random() * 120 - 60)}`);
          branch.setAttribute('class', 'crack-path branch');
          branch.style.animationDelay = (i * 0.22 + 0.6) + 's';
          svg.appendChild(branch);
        }
      });

      for (let i = 0; i < 8; i++) {
        const piece = document.createElement('div');
        piece.className = 'shatter-piece';
        const size = 40 + Math.random() * 60;

        piece.style.width = size + 'px';
        piece.style.height = size + 'px';
        piece.style.left = (centerX + Math.random() * 300 - 150) + 'px';
        piece.style.top = (centerY + Math.random() * 200 - 100) + 'px';
        piece.style.setProperty('--tx', (Math.random() * 140 - 70) + 'px');
        piece.style.setProperty('--rot', (Math.random() * 360) + 'deg');
        piece.style.animationDelay = (0.55 + Math.random() * 0.35) + 's';

        overlay.appendChild(piece);
      }
    }

    function startTransition() {
      if (isValentineMode) return;

      createIceCrack();

      setTimeout(() => {
        isValentineMode = true;
        body.classList.add('valentine-mode');
        cursor.textContent = 'üíñ';

        hud.style.display = 'none';
        cheeseLayer.style.display = 'none';
        clearCheese();
        if (pawLayer) pawLayer.style.display = 'none';

        document.getElementById('hockeyText').style.display = 'none';
        const mainText = document.getElementById('mainText');
        mainText.style.display = 'block';
        mainText.classList.add('valentine-mode');

        document.getElementById('blushLeft').style.opacity = '0.6';
        document.getElementById('blushRight').style.opacity = '0.6';
        document.getElementById('topHeart').style.opacity = '1';

        yesBtn.style.setProperty('--current-scale', String(YES_BASE_SCALE));
        yesBtn.classList.add('glow-3'); // immediate focus

        const sub = document.getElementById('subtitle');
        sub.textContent = 'Tap "No" 5 times to make it disappear.';

        setTimeout(() => document.getElementById('iceOverlay').classList.remove('active'), 900);

        setTimeout(() => {
          zone.classList.add('active');
          hint.classList.add('visible');
          transitionDone = true;
          if (navigator.vibrate) navigator.vibrate([50, 100, 50]);
        }, 650);
      }, 900);
    }

    function createPulseRing() {
      const ring = document.createElement('div');
      ring.className = 'pulse-ring';
      ring.style.width = '100%';
      ring.style.height = '100%';
      ring.style.animation = 'ringExpand 0.8s ease-out forwards';
      yesContainer.appendChild(ring);
      setTimeout(() => ring.remove(), 800);
    }

    function spawnNoSpark(x, y) {
      const s = document.createElement('div');
      s.className = 'no-spark';
      s.textContent = ['‚ú¶','‚Ä¢','+','‚ô•'][Math.floor(Math.random() * 4)];
      s.style.left = x + 'px';
      s.style.top = y + 'px';
      s.style.setProperty('--tx', (Math.random() * 60 - 30) + 'px');
      s.style.setProperty('--ty', (Math.random() * -60 - 25) + 'px');
      document.getElementById('trail-container').appendChild(s);
      setTimeout(() => s.remove(), 800);
    }

    function growYes() {
      yesGrowthLevel++;
      yesScale = Math.min(YES_MAX_SCALE, YES_BASE_SCALE + (yesGrowthLevel * YES_GROW_STEP));
      yesBtn.style.setProperty('--current-scale', yesScale.toFixed(3));

      yesBtn.className = '';
      if (yesGrowthLevel >= 1) yesBtn.classList.add('glow-1');
      if (yesGrowthLevel >= 2) yesBtn.classList.add('glow-2');
      if (yesGrowthLevel >= 3) yesBtn.classList.add('glow-3');
      if (yesGrowthLevel >= 4) yesBtn.classList.add('glow-4');
      if (yesGrowthLevel >= 5) {
        yesBtn.classList.add('glow-5');
        yesMicrotext.classList.add('visible');
      }

      createPulseRing();
      if (navigator.vibrate) navigator.vibrate(35);
    }

    function applyNoFadeLevel() {
      noBtn.classList.remove('fade-1','fade-2','fade-3','fade-4','vanish');

      if (noHidden) {
        noBtn.classList.add('vanish');
        return;
      }

      if (noPresses >= 1) noBtn.classList.add('fade-1');
      if (noPresses >= 2) noBtn.classList.add('fade-2');
      if (noPresses >= 3) noBtn.classList.add('fade-3');
      if (noPresses >= 4) noBtn.classList.add('fade-4');
      if (noPresses >= NO_VANISH_AT) {
        noHidden = true;
        noBtn.classList.add('vanish');
        hint.textContent = '"No" is gone. The answer is obvious.';
        setTimeout(() => { noBtn.style.display = 'none'; }, 450);
      }
    }

    // More playful movement: frequent hops, stronger dodge, mobile-safe loop
    let isMoving = false;
    let animFrame = null;

    function setNoPositionWithinZone(targetLeftPx, targetTopPx, rotDeg) {
      const zr = zone.getBoundingClientRect();
      const nr = noBtn.getBoundingClientRect();

      let nl = targetLeftPx;
      let nt = targetTopPx;

      nl = Math.max(12, Math.min(nl, zr.width - nr.width - 12));
      nt = Math.max(12, Math.min(nt, zr.height - nr.height - 12));

      const cx = nl + nr.width / 2;
      const cy = nt + nr.height / 2;

      noBtn.style.left = cx + 'px';
      noBtn.style.top  = cy + 'px';
      noBtn.style.transform = `translate(-50%, -50%) rotate(${rotDeg}deg)`;
    }

    function hopNoRandomly(intensity = 1) {
      if (noHidden || !transitionDone) return;
      const zr = zone.getBoundingClientRect();
      const nr = noBtn.getBoundingClientRect();

      const margin = 12;
      const w = Math.max(60, zr.width - nr.width - margin * 2);
      const h = Math.max(60, zr.height - nr.height - margin * 2);

      const biasAwayX = (lastPointerX - (zr.left + zr.width / 2));
      const biasAwayY = (lastPointerY - (zr.top + zr.height / 2));

      // Push to the opposite side of finger a bit
      const bx = clamp((-biasAwayX / Math.max(1, zr.width)) * 0.35, -0.35, 0.35);
      const by = clamp((-biasAwayY / Math.max(1, zr.height)) * 0.35, -0.35, 0.35);

      const x = margin + (0.5 + bx) * w + rand(-40, 40) * intensity;
      const y = margin + (0.5 + by) * h + rand(-40, 40) * intensity;

      setNoPositionWithinZone(x, y, rand(-16, 16) * intensity);
    }

    function dodgeNo(px, py) {
      if (noHidden || isMoving || !transitionDone) return;
      isMoving = true;

      const zr = zone.getBoundingClientRect();
      const nr = noBtn.getBoundingClientRect();

      const ncx = nr.left + nr.width / 2;
      const ncy = nr.top + nr.height / 2;

      const baseThreshold = isMobileLike ? 230 : 175;
      const threshold = baseThreshold + (noPresses * 8); // gets more chaotic

      if (Math.hypot(px - ncx, py - ncy) < threshold) {
        let dx = ncx - px;
        let dy = ncy - py;
        const mag = Math.hypot(dx, dy) || 1;

        const hop = (isMobileLike ? 260 : 210) + (noPresses * 18);
        let nl = (nr.left - zr.left) + (dx / mag) * hop + rand(-55, 55);
        let nt = (nr.top - zr.top) + (dy / mag) * hop + rand(-55, 55);

        // occasional extra hop for "more rumspringen"
        if (Math.random() > 0.58) {
          nl += rand(-120, 120);
          nt += rand(-90, 90);
        }

        nl = Math.max(12, Math.min(nl, zr.width - nr.width - 12));
        nt = Math.max(12, Math.min(nt, zr.height - nr.height - 12));

        const cx = nl + nr.width / 2;
        const cy = nt + nr.height / 2;

        noBtn.style.left = cx + 'px';
        noBtn.style.top  = cy + 'px';
        noBtn.style.transform = `translate(-50%, -50%) rotate(${rand(-18, 18)}deg)`;

        for (let i = 0; i < (isMobileLike ? 6 : 4); i++) spawnNoSpark(ncx + rand(-14,14), ncy + rand(-14,14));
      }

      setTimeout(() => { isMoving = false; }, 18);
    }

    function onZonePointerMove(e) {
      if (!transitionDone) return;
      if (animFrame) return;
      animFrame = requestAnimationFrame(() => {
        dodgeNo(e.clientX, e.clientY);
        animFrame = null;
      });
    }

    function onZonePointerDown(e) {
      if (!transitionDone) return;
      e.preventDefault();
      dodgeNo(e.clientX, e.clientY);
    }

    zone.addEventListener('pointerdown', onZonePointerDown, { passive: false });
    zone.addEventListener('pointermove', onZonePointerMove, { passive: true });

    // Mobile: keep last finger point and run a small loop so it dodges reliably
    zone.addEventListener('touchstart', (e) => {
      if (!transitionDone || !e.touches || !e.touches[0]) return;
      const t = e.touches[0];
      setTarget(t.clientX, t.clientY);
      // instant reaction
      dodgeNo(t.clientX, t.clientY);
    }, { passive: true });

    zone.addEventListener('touchmove', (e) => {
      if (!transitionDone || !e.touches || !e.touches[0]) return;
      const t = e.touches[0];
      setTarget(t.clientX, t.clientY);
      // do not block scrolling of the card, only react
      dodgeNo(t.clientX, t.clientY);
    }, { passive: true });

    // Continuous "playful" behavior: if finger is down, it keeps dodging
    function mobileDodgeLoop() {
      if (transitionDone && isMobileLike && !noHidden) {
        // If finger is down or recently used, react more
        if (pointerActive) dodgeNo(lastPointerX, lastPointerY);

        // Random hops to feel alive
        if (Math.random() > 0.92) hopNoRandomly(1);

        // Slowly decay "active"
        if (Math.random() > 0.80) pointerActive = false;
      }
      requestAnimationFrame(mobileDodgeLoop);
    }
    mobileDodgeLoop();

    // Extra: periodic micro-hop even without touch, so it "rumspringt" more
    let hopTimer = null;
    function startHopTimer() {
      if (hopTimer) clearInterval(hopTimer);
      hopTimer = setInterval(() => {
        if (!transitionDone || noHidden) return;
        // do not make it impossible, hop less often after many presses
        const p = clamp(0.42 - noPresses * 0.06, 0.16, 0.42);
        if (Math.random() < p) hopNoRandomly(0.9);
      }, isMobileLike ? 520 : 700);
    }

    // Pressing No: counts 1..5, fades each time, grows Yes each time, then vanishes at 5
    noBtn.addEventListener('pointerdown', (e) => {
      if (noHidden || !transitionDone) return;
      e.preventDefault();

      noPresses++;
      growYes();
      applyNoFadeLevel();

      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top + r.height / 2;
      for (let i = 0; i < (isMobileLike ? 10 : 7); i++) spawnNoSpark(cx + rand(-18,18), cy + rand(-18,18));

      if (!noHidden) {
        hint.textContent = `"No" pressed (${noPresses}/${NO_VANISH_AT}). Again.`;
        // playful multi-hop after a successful press
        dodgeNo(cx + rand(-60,60), cy + rand(-60,60));
        setTimeout(() => dodgeNo(cx + rand(-80,80), cy + rand(-80,80)), 70);
        if (Math.random() > 0.5) setTimeout(() => hopNoRandomly(1.0), 140);
      }
    }, { passive: false });

    // Prevent click fallback double-firing
    noBtn.addEventListener('click', (e) => e.preventDefault());

    yesBtn.addEventListener('click', () => {
      zone.style.display = 'none';
      hint.style.display = 'none';
      result.style.display = 'block';

      myConfetti({ particleCount: 170, spread: 115, origin: { y: 0.62 }, colors: ['#ff3b7a', '#ff7aa2', '#ffd6e7'] });
      setTimeout(() => myConfetti({ particleCount: 130, spread: 135, origin: { y: 0.82 }, colors: ['#ff3b7a', '#ff7aa2'] }), 280);

      if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);

      card.scrollTo({ top: card.scrollHeight, behavior: 'smooth' });
    });

    [yesBtn, noBtn].forEach(btn => {
      btn.addEventListener('mouseenter', () => cursor.classList.add('hovering'));
      btn.addEventListener('mouseleave', () => cursor.classList.remove('hovering'));
    });

    window.addEventListener('load', () => {
      const now = performance.now();
      sacc.nextRetarget = now + rand(30, 120);
      sacc.nextImpulse = now + rand(350, 1200);
      spawnCheesePieces();
    });

    window.addEventListener('resize', () => {
      if (!isValentineMode) spawnCheesePieces();
    });

    // Ensure hop timer starts once Valentine is unlocked
    const _origStartTransition = startTransition;
    startTransition = function() {
      _origStartTransition();
      setTimeout(() => {
        if (transitionDone) {
          startHopTimer();
          // place No initially somewhere "alive"
          hopNoRandomly(1);
        }
      }, 1700);
    };
  </script>
</body>
</html>
