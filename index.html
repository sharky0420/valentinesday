<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cottage Invitation</title>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;600;800&display=swap');

    :root {
      --hockey-bg: #0B1120;
      --hockey-card: #111827;
      --hockey-text: #E2E8F0;
      --hockey-accent: #B11226;
      --val-bg1: #ffd6e7;
      --val-bg2: #ffeef6;
      --val-card: #ffffffcc;
      --val-yes: #ff3b7a;
      --val-text: #1f2937;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100svh;
      display: grid;
      place-items: center;
      font-family: 'Inter', system-ui, sans-serif;
      overflow: hidden;
      padding: 20px;
      touch-action: manipulation;
      cursor: none;
      transition: background 1.5s ease-in-out;
      background:
        radial-gradient(circle at 20% 50%, rgba(31, 78, 216, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 30%, rgba(177, 18, 38, 0.1) 0%, transparent 40%),
        linear-gradient(180deg, #0B1120 0%, #0F172A 100%);
    }

    body.valentine-mode {
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), #fff5f8, var(--val-bg2), var(--val-bg1));
    }

    /* Cursor */
    .cursor-heart {
      width: 34px;
      height: 34px;
      position: fixed;
      pointer-events: none;
      z-index: 10000;
      transform: translate(-50%, -50%);
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.2s ease;
      font-size: 34px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 4px 12px rgba(177, 18, 38, 0.65));
    }

    body.valentine-mode .cursor-heart {
      filter: drop-shadow(0 4px 12px rgba(255, 59, 122, 0.55));
      transform: translate(-50%, -50%) scale(1.08);
    }

    .cursor-heart.hovering {
      transform: translate(-50%, -50%) scale(1.5) !important;
      filter: drop-shadow(0 8px 25px rgba(255, 59, 122, 0.8)) !important;
    }

    @media (max-width: 768px) {
      .cursor-heart { width: 30px; height: 30px; font-size: 30px; }
    }

    /* Cursor trail */
    .trail-dot {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      pointer-events: none;
      z-index: 9996;
      background: rgba(226, 232, 240, 0.45);
      transform: translate(-50%, -50%) scale(1);
      animation: trailFade 600ms ease-out forwards;
      filter: blur(0.2px);
    }

    body.valentine-mode .trail-dot {
      background: rgba(255, 59, 122, 0.28);
    }

    @keyframes trailFade {
      0% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
    }

    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }

    /* Ice overlay */
    .ice-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(200, 230, 255, 0.1);
      backdrop-filter: blur(2px);
    }
    .ice-overlay.active { opacity: 1; }

    .crack-svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .crack-path {
      fill: none;
      stroke: rgba(255, 255, 255, 0.9);
      stroke-width: 2;
      stroke-linecap: round;
      filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: crackDraw 2.2s ease-out forwards;
    }
    .crack-path.branch {
      stroke-width: 1.5;
      stroke: rgba(255, 255, 255, 0.7);
    }
    @keyframes crackDraw { to { stroke-dashoffset: 0; } }

    .shatter-piece {
      position: absolute;
      background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(200,220,255,0.2));
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,0.6);
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      opacity: 0;
      animation: shatterFall 2.4s ease-in forwards;
    }
    @keyframes shatterFall {
      0% { opacity: 1; transform: translate(0, 0) rotate(0deg) scale(1); }
      100% { opacity: 0; transform: translate(var(--tx), 100vh) rotate(var(--rot)) scale(0.5); }
    }

    /* Card */
    .card {
      width: min(680px, 92vw);
      padding: clamp(32px, 6vw, 48px);
      border-radius: 4px;
      text-align: center;
      position: relative;
      z-index: 1;
      transform-style: preserve-3d;
      transform: perspective(1000px) rotateX(var(--rotateX, 0deg)) rotateY(var(--rotateY, 0deg));
      transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(177, 18, 38, 0.3);
      border-left: 4px solid var(--hockey-accent);
      box-shadow: 0 25px 80px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
    }

    body.valentine-mode .card {
      background: var(--val-card);
      border: 1px solid rgba(255,255,255,0.5);
      border-left: none;
      border-radius: 28px;
      box-shadow: 0 20px 70px rgba(0,0,0,.12);
    }

    .ice-texture {
      position: absolute;
      inset: 0;
      opacity: 0.03;
      background-image:
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255,255,255,0.1) 50px, rgba(255,255,255,0.1) 51px),
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(255,255,255,0.1) 50px, rgba(255,255,255,0.1) 51px);
      pointer-events: none;
      transition: opacity 1s ease;
    }
    body.valentine-mode .ice-texture { opacity: 0; }

    .hockey-decoration {
      position: absolute;
      top: 24px;
      right: 24px;
      opacity: 0.4;
      transition: all 0.8s ease;
      pointer-events: none;
      font-size: 48px;
      filter: grayscale(100%) brightness(1.5);
    }
    body.valentine-mode .hockey-decoration {
      opacity: 0;
      transform: translateY(-20px) rotate(20deg);
    }

    /* Cheese HUD */
    .hud {
      position: fixed;
      left: 18px;
      top: 18px;
      z-index: 9995;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.65);
      border: 1px solid rgba(177, 18, 38, 0.25);
      color: rgba(226, 232, 240, 0.92);
      backdrop-filter: blur(10px);
      font-size: 13px;
      letter-spacing: 0.02em;
      user-select: none;
    }
    body.valentine-mode .hud { display: none; }

    .hud .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(255,255,255,0.08);
    }

    /* Cheese pieces */
    .cheese {
      position: fixed;
      z-index: 9994;
      font-size: 34px;
      line-height: 1;
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg));
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
      user-select: none;
      pointer-events: none;
      opacity: 0;
      animation: cheeseIn 380ms ease-out forwards;
    }
    @keyframes cheeseIn {
      to { opacity: 1; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1); }
    }

    .cheese.pop {
      animation: cheesePop 260ms ease-in forwards;
    }
    @keyframes cheesePop {
      0% { opacity: 1; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1.6); }
    }

    /* Art + text */
    .art-container {
      position: relative;
      width: min(220px, 55vw);
      height: min(180px, 45vw);
      margin: 0 auto 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.8s ease;
    }
    body.valentine-mode .art-container { transform: scale(1.15); }

    .art {
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s ease forwards;
      transition: all 0.5s ease;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
    }
    body.valentine-mode .art { filter: drop-shadow(0 15px 30px rgba(255,59,122,0.25)); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

    .text-container {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 24px 0;
      position: relative;
      transform: translateZ(20px);
      transition: all 0.8s ease;
    }

    .quote-text {
      font-family: 'Crimson Text', Georgia, serif;
      font-size: clamp(18px, 4vw, 26px);
      line-height: 1.7;
      color: var(--hockey-text);
      font-style: italic;
      max-width: 580px;
      text-align: left;
      position: relative;
      padding: 0 24px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      letter-spacing: 0.02em;
    }
    .quote-text::before {
      content: '"';
      font-size: 80px;
      color: var(--hockey-accent);
      position: absolute;
      top: -30px;
      left: -10px;
      opacity: 0.4;
      font-family: Georgia, serif;
    }
    body.valentine-mode .quote-text { display: none; }

    h1 {
      font-size: clamp(26px, 6vw, 42px);
      margin: 0;
      line-height: 1.2;
      font-weight: 800;
      letter-spacing: -0.02em;
      position: relative;
      display: none;
      color: var(--val-text);
      transition: all 0.8s ease;
    }
    h1.valentine-mode {
      display: block;
      color: var(--val-yes);
      text-shadow: 0 2px 20px rgba(255, 59, 122, 0.2);
      animation: heartbeat 1.8s ease-in-out infinite;
      font-family: 'Inter', sans-serif;
    }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    .scramble-text { font-family: 'Courier New', monospace; }

    .cursor {
      display: inline-block;
      width: 3px;
      height: 0.9em;
      background: var(--val-yes);
      margin-left: 4px;
      animation: blink 1.2s infinite;
      vertical-align: baseline;
    }
    @keyframes blink {
      0%, 45% { opacity: 1; }
      50%, 95% { opacity: 0; }
    }

    .subtitle {
      font-size: 13px;
      color: #64748B;
      margin-top: 24px;
      text-transform: uppercase;
      letter-spacing: 4px;
      font-weight: 600;
      transition: all 0.5s ease;
      font-family: 'Inter', sans-serif;
    }
    .subtitle::before { content: '‚Äî '; color: var(--hockey-accent); }

    body.valentine-mode .subtitle {
      color: #6b7280;
      text-transform: none;
      letter-spacing: 0.5px;
      font-weight: 500;
    }
    body.valentine-mode .subtitle::before { content: none; }

    /* Buttons */
    .button-zone {
      position: relative;
      width: 100%;
      height: min(180px, 30vh);
      margin: 32px auto 12px;
      touch-action: none;
      user-select: none;
      opacity: 0;
      pointer-events: none;
      transform: scale(0.9) translateY(20px);
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .button-zone.active {
      opacity: 1;
      pointer-events: all;
      transform: scale(1) translateY(0);
    }

    .yes-container {
      position: absolute;
      left: 15%;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    #yesBtn {
      position: relative;
      padding: 22px 44px;
      font-size: clamp(18px, 4vw, 24px);
      font-weight: 800;
      border-radius: 999px;
      border: none;
      cursor: none;
      background: var(--val-yes);
      color: #fff;
      box-shadow: 0 10px 30px rgba(255, 59, 122, 0.3);
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.25s ease, background 0.25s ease;
      min-width: 130px;
      min-height: 66px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transform: scale(var(--current-scale, 1));
    }

    #yesBtn.glow-1 { box-shadow: 0 12px 35px rgba(255, 59, 122, 0.35); }
    #yesBtn.glow-2 { box-shadow: 0 14px 40px rgba(255, 59, 122, 0.4); }
    #yesBtn.glow-3 { box-shadow: 0 16px 45px rgba(255, 59, 122, 0.45), 0 0 40px rgba(255, 59, 122, 0.1); }
    #yesBtn.glow-4 { box-shadow: 0 18px 50px rgba(255, 59, 122, 0.5), 0 0 60px rgba(255, 59, 122, 0.15); }
    #yesBtn.glow-5 {
      box-shadow: 0 20px 55px rgba(255, 59, 122, 0.55), 0 0 80px rgba(255, 59, 122, 0.2);
      animation: yesPulse 2s ease-in-out infinite;
    }
    @keyframes yesPulse {
      0%, 100% { transform: scale(var(--current-scale, 1)); }
      50% { transform: scale(calc(var(--current-scale, 1) * 1.02)); }
    }
    #yesBtn:hover {
      background: #ff1f68;
      transform: scale(calc(var(--current-scale, 1) * 1.05));
    }

    .pulse-ring {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255, 59, 122, 0.5);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
    }
    @keyframes ringExpand {
      0% { width: 100%; height: 100%; opacity: 0.5; }
      100% { width: 180%; height: 180%; opacity: 0; }
    }

    .yes-microtext {
      font-size: 11px;
      color: var(--val-yes);
      opacity: 0;
      transform: translateY(-5px);
      transition: all 0.5s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
      font-style: italic;
      white-space: nowrap;
      margin-top: 4px;
    }
    .yes-microtext.visible { opacity: 0.9; transform: translateY(0); }

    #noBtn {
      position: absolute;
      left: 65%;
      top: 50%;
      transform: translateY(-50%);
      padding: 18px 36px;
      font-size: clamp(16px, 3.5vw, 20px);
      font-weight: 700;
      border-radius: 999px;
      border: none;
      cursor: none;
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      color: #334155;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 20;
    }
    #noBtn:hover {
      background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
      transform: translateY(-50%) scale(0.92);
    }

    @media (max-width: 400px) {
      .button-zone { height: 190px; }
      .yes-container {
        left: 50% !important;
        top: 20% !important;
        transform: translate(-50%, -50%);
      }
      #yesBtn { padding: 20px 40px; }
      #noBtn {
        left: 50% !important;
        top: 80% !important;
        transform: translate(-50%, -50%);
      }
    }

    .hint {
      margin-top: 20px;
      font-size: 14px;
      opacity: 0;
      color: #64748b;
      font-weight: 500;
      transition: opacity 0.5s ease 0.3s;
      font-style: italic;
      user-select: none;
    }
    body.valentine-mode .hint { color: #6b7280; }
    .hint.visible { opacity: 0.85; }

    .result {
      display: none;
      margin-top: 20px;
      animation: pop .5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      text-align: center;
      width: 100%;
    }
    .result h2 {
      font-size: clamp(28px, 7vw, 48px);
      margin: 0 0 20px 0;
      background: linear-gradient(135deg, var(--val-yes), #ff6b9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }
    .fireworks {
      width: min(320px, 85vw);
      max-height: 240px;
      object-fit: contain;
      margin: 0 auto 20px auto;
      display: block;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .russian-text {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
      font-family: 'Inter', sans-serif;
      margin-top: 8px;
      opacity: 0.9;
      letter-spacing: 0.02em;
    }

    @keyframes pop {
      from { transform: scale(0.8) translateY(30px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }
  </style>
</head>

<body>
  <div class="ice-overlay" id="iceOverlay">
    <svg class="crack-svg" id="crackSvg" preserveAspectRatio="none"></svg>
  </div>
  <canvas id="confettiCanvas"></canvas>

  <div class="hud" id="hud">
    <span class="chip">üßÄ <span id="cheeseCount">0</span>/5</span>
    <span id="hudText">Collect the cheese to unlock the next screen.</span>
  </div>

  <div class="cursor-heart" id="cursor">üê≠</div>
  <div id="trail-container"></div>
  <div id="cheese-layer"></div>

  <main class="card" id="card">
    <div class="ice-texture"></div>
    <div class="hockey-decoration">üèí</div>

    <div class="art-container">
      <svg class="art" viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg" id="catSvg">
        <defs>
          <linearGradient id="fur" x1="0" x2="1">
            <stop offset="0" stop-color="#f7c7a1"/>
            <stop offset="1" stop-color="#f2a97b"/>
          </linearGradient>
          <linearGradient id="heart" x1="0" x2="1">
            <stop offset="0" stop-color="#ff4d7d"/>
            <stop offset="1" stop-color="#ff1f68"/>
          </linearGradient>
        </defs>

        <path d="M250 50 C250 33 270 25 282 38 C294 25 314 33 314 50 C314 78 282 92 282 106 C282 92 250 78 250 50Z"
              fill="url(#heart)" id="topHeart" opacity="0" style="transition: opacity 1s ease"/>

        <path d="M90 120 C90 70 140 40 190 60 C240 40 290 70 290 120 C290 180 240 210 190 210 C140 210 90 180 90 120Z"
              fill="url(#fur)"/>

        <path d="M110 92 L95 55 L140 78 Z" fill="#f2a97b"/>
        <path d="M270 92 L285 55 L240 78 Z" fill="#f2a97b"/>

        <g class="eye-group">
          <circle cx="155" cy="125" r="17" fill="#1f2937"/>
          <circle class="eye-pupil" id="eyeLeft" cx="158" cy="122" r="6" fill="white"/>
          <circle cx="161" cy="119" r="3" fill="white" opacity="0.9"/>

          <circle cx="225" cy="125" r="17" fill="#1f2937"/>
          <circle class="eye-pupil" id="eyeRight" cx="228" cy="122" r="6" fill="white"/>
          <circle cx="231" cy="119" r="3" fill="white" opacity="0.9"/>
        </g>

        <ellipse cx="125" cy="148" rx="15" ry="10" fill="#ff7aa2" opacity="0" id="blushLeft" style="transition: opacity 1s ease"/>
        <ellipse cx="255" cy="148" rx="15" ry="10" fill="#ff7aa2" opacity="0" id="blushRight" style="transition: opacity 1s ease"/>

        <path d="M190 144 C186 144 182 148 182 152 C182 160 190 164 190 170 C190 164 198 160 198 152 C198 148 194 144 190 144Z"
              fill="#ff7aa2"/>

        <line x1="140" y1="150" x2="105" y2="142" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="140" y1="156" x2="102" y2="156" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="140" y1="162" x2="105" y2="170" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>

        <line x1="240" y1="150" x2="275" y2="142" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="240" y1="156" x2="278" y2="156" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
        <line x1="240" y1="162" x2="275" y2="170" stroke="#1f2937" stroke-width="1.5" opacity="0.3" stroke-linecap="round"/>
      </svg>
    </div>

    <div class="text-container">
      <div class="quote-text" id="hockeyText">
        Will you come to my cottage this summer? Don't go to Russia. Come to my house. We'll have so much fun. It's private. No one will know. We could have a week, or even two. We'll be completely alone. Together.
      </div>

      <h1 id="mainText" class="scramble-text" style="display: none;">
        Will you be my valentine?<span class="cursor"></span>
      </h1>

      <p class="subtitle" id="subtitle">Shane &amp; Ilya</p>
    </div>

    <section class="button-zone" id="zone">
      <div class="yes-container" id="yesContainer">
        <button id="yesBtn" type="button">Yes</button>
        <span class="yes-microtext" id="yesMicrotext">you know you want to</span>
      </div>
      <button id="noBtn" type="button">No</button>
    </section>

    <div class="hint" id="hint">"No" is feeling shy, try to catch it.</div>

    <section class="result" id="result">
      <h2>YAY!</h2>
      <img class="fireworks" src="https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif" alt="Celebration" loading="lazy"/>
      <p class="russian-text">–£—Ä–∞! –°–ø–∞—Å–∏–±–æ :) –Ø —Å–∞–º—ã–π —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –º–∏—Ä–µ</p>
    </section>
  </main>

  <!-- √ÑNDERE NUR DEN <script> TEIL, konkret: 1) updateEye erweitern, 2) animateCursor erweitert, 3) touchstart hinzuf√ºgen -->

<script>
    let isValentineMode = false;
    let transitionDone = false;
    let yesGrowthLevel = 0;
    let yesScale = 1;
  
    const body = document.body;
    const cursor = document.getElementById('cursor');
    const card = document.getElementById('card');
  
    const yesBtn = document.getElementById('yesBtn');
    const yesContainer = document.getElementById('yesContainer');
    const yesMicrotext = document.getElementById('yesMicrotext');
  
    const zone = document.getElementById('zone');
    const noBtn = document.getElementById('noBtn');
    const result = document.getElementById('result');
    const hint = document.getElementById('hint');
  
    // Cursor tracking
    let mouseX = window.innerWidth / 2, mouseY = window.innerHeight / 2;
    let cursorX = mouseX, cursorY = mouseY;
  
    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
  
      // Valentine Hintergrund + Card Tilt nur im Valentine Screen
      if (isValentineMode) {
        body.style.setProperty('--mouse-x', (mouseX / window.innerWidth * 100) + '%');
        body.style.setProperty('--mouse-y', (mouseY / window.innerHeight * 100) + '%');
  
        const rect = card.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
  
        const rotateX = ((mouseY - centerY) / (window.innerHeight / 2)) * -3;
        const rotateY = ((mouseX - centerX) / (window.innerWidth / 2)) * 3;
        card.style.setProperty('--rotateX', rotateX + 'deg');
        card.style.setProperty('--rotateY', rotateY + 'deg');
  
        if (Math.random() > 0.92) spawnParticle(mouseX, mouseY);
      }
    });
  
    // NEU: touchstart, damit "Tippen" am Handy sofort das Ziel setzt
    document.addEventListener('touchstart', (e) => {
      if (!e.touches[0]) return;
      const t = e.touches[0];
      mouseX = t.clientX;
      mouseY = t.clientY;
    }, { passive: true });
  
    document.addEventListener('touchmove', (e) => {
      if (!e.touches[0]) return;
      const t = e.touches[0];
      mouseX = t.clientX;
      mouseY = t.clientY;
  
      if (isValentineMode && Math.random() > 0.85) spawnParticle(t.clientX, t.clientY);
    }, { passive: true });
  
    function animateCursor() {
      cursorX += (mouseX - cursorX) * 0.15;
      cursorY += (mouseY - cursorY) * 0.15;
  
      cursor.style.left = cursorX + 'px';
      cursor.style.top = cursorY + 'px';
  
      // WICHTIG: Augen folgen IMMER dem Cursor (Maus/Herz), unabh√§ngig vom Screen
      updateEye('eyeLeft', 155, 125, 5, cursorX, cursorY);
      updateEye('eyeRight', 225, 125, 5, cursorX, cursorY);
  
      requestAnimationFrame(animateCursor);
    }
    animateCursor();
  
    // √ÑNDERN: updateEye bekommt jetzt Zielkoordinaten (tx, ty) statt immer mouseX/mouseY zu nutzen
    function updateEye(id, cx, cy, maxOff, tx, ty) {
      const eye = document.getElementById(id);
      const svg = document.getElementById('catSvg');
      if (!eye || !svg) return;
  
      const rect = svg.getBoundingClientRect();
  
      const eyeX = rect.left + (cx / 320) * rect.width;
      const eyeY = rect.top + (cy / 240) * rect.height;
  
      const angle = Math.atan2(ty - eyeY, tx - eyeX);
      const dist = Math.min(maxOff, Math.hypot(tx - eyeX, ty - eyeY) / 15);
  
      eye.setAttribute('cx', cx + Math.cos(angle) * dist);
      eye.setAttribute('cy', cy + Math.sin(angle) * dist);
    }
  
    function spawnParticle(x, y) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.textContent = ['‚ô•', '‚ú¶', '+', '‚Ä¢'][Math.floor(Math.random() * 4)];
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      p.style.setProperty('--tx', (Math.random() * 100 - 50) + 'px');
      p.style.setProperty('--ty', (Math.random() * -100 - 50) + 'px');
      document.getElementById('trail-container').appendChild(p);
      setTimeout(() => p.remove(), 3000);
    }
  
    // Ice crack generation (SVG + shards)
    function createIceCrack() {
      const overlay = document.getElementById('iceOverlay');
      const svg = document.getElementById('crackSvg');
  
      svg.innerHTML = '';
      overlay.querySelectorAll('.shatter-piece').forEach(el => el.remove());
      overlay.classList.add('active');
  
      const w = window.innerWidth;
      const h = window.innerHeight;
      const centerX = w / 2;
      const centerY = h / 2;
  
      const cracks = [
        `M ${centerX} ${centerY} L ${centerX + 200} ${centerY - 150} L ${centerX + 350} ${centerY - 180}`,
        `M ${centerX} ${centerY} L ${centerX - 180} ${centerY - 200} L ${centerX - 300} ${centerY - 250}`,
        `M ${centerX} ${centerY} L ${centerX + 100} ${centerY + 200} L ${centerX + 150} ${centerY + 350}`,
        `M ${centerX} ${centerY} L ${centerX - 220} ${centerY + 100} L ${centerX - 400} ${centerY + 150}`,
        `M ${centerX} ${centerY} L ${centerX + 50} ${centerY - 300} L ${centerX + 80} ${centerY - 450}`,
      ];
  
      cracks.forEach((d, i) => {
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', d);
        path.setAttribute('class', 'crack-path');
        path.style.animationDelay = (i * 0.2) + 's';
        svg.appendChild(path);
  
        if (Math.random() > 0.3) {
          const branch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          const midX = centerX + (Math.random() * 200 - 100);
          const midY = centerY + (Math.random() * 200 - 100);
          branch.setAttribute('d', `M ${midX} ${midY} L ${midX + (Math.random() * 120 - 60)} ${midY + (Math.random() * 120 - 60)}`);
          branch.setAttribute('class', 'crack-path branch');
          branch.style.animationDelay = (i * 0.2 + 0.5) + 's';
          svg.appendChild(branch);
        }
      });
  
      for (let i = 0; i < 8; i++) {
        const piece = document.createElement('div');
        piece.className = 'shatter-piece';
        const size = 40 + Math.random() * 60;
  
        piece.style.width = size + 'px';
        piece.style.height = size + 'px';
        piece.style.left = (centerX + Math.random() * 300 - 150) + 'px';
        piece.style.top = (centerY + Math.random() * 200 - 100) + 'px';
        piece.style.setProperty('--tx', (Math.random() * 140 - 70) + 'px');
        piece.style.setProperty('--rot', (Math.random() * 360) + 'deg');
        piece.style.animationDelay = (0.5 + Math.random() * 0.3) + 's';
  
        overlay.appendChild(piece);
      }
    }
  
    // Transition after 5 seconds
    setTimeout(() => startTransition(), 5000);
  
    function startTransition() {
      createIceCrack();
  
      setTimeout(() => {
        isValentineMode = true;
        body.classList.add('valentine-mode');
        cursor.textContent = 'üíñ';
  
        document.getElementById('hockeyText').style.display = 'none';
        const mainText = document.getElementById('mainText');
        mainText.style.display = 'block';
        mainText.classList.add('valentine-mode');
  
        document.getElementById('blushLeft').style.opacity = '0.6';
        document.getElementById('blushRight').style.opacity = '0.6';
        document.getElementById('topHeart').style.opacity = '1';
  
        const sub = document.getElementById('subtitle');
        sub.textContent = 'Move your mouse...';
  
        setTimeout(() => {
          document.getElementById('iceOverlay').classList.remove('active');
        }, 800);
  
        setTimeout(() => {
          zone.classList.add('active');
          hint.classList.add('visible');
          transitionDone = true;
          if (navigator.vibrate) navigator.vibrate([50, 100, 50]);
        }, 600);
      }, 800);
    }
  
    // Yes reward mechanic
    function growYes() {
      yesGrowthLevel++;
      yesScale = Math.min(2.0, 1 + (yesGrowthLevel * 0.06));
      yesBtn.style.setProperty('--current-scale', yesScale.toFixed(3));
  
      yesBtn.className = '';
      if (yesGrowthLevel >= 2) yesBtn.classList.add('glow-1');
      if (yesGrowthLevel >= 4) yesBtn.classList.add('glow-2');
      if (yesGrowthLevel >= 6) yesBtn.classList.add('glow-3');
      if (yesGrowthLevel >= 8) yesBtn.classList.add('glow-4');
      if (yesGrowthLevel >= 10) {
        yesBtn.classList.add('glow-5');
        yesMicrotext.classList.add('visible');
      }
  
      createPulseRing();
      if (navigator.vibrate) navigator.vibrate(40);
    }
  
    function createPulseRing() {
      const ring = document.createElement('div');
      ring.className = 'pulse-ring';
      ring.style.width = '100%';
      ring.style.height = '100%';
      ring.style.animation = 'ringExpand 0.8s ease-out forwards';
      yesContainer.appendChild(ring);
      setTimeout(() => ring.remove(), 800);
    }
  
    // No button evasion
    let isMoving = false;
  
    function moveNo(px, py) {
      if (isMoving || !transitionDone) return;
      isMoving = true;
  
      const zr = zone.getBoundingClientRect();
      const nr = noBtn.getBoundingClientRect();
      const ncx = nr.left + nr.width / 2;
      const ncy = nr.top + nr.height / 2;
  
      const threshold = (window.innerWidth < 400 ? 100 : 140);
  
      if (Math.hypot(px - ncx, py - ncy) < threshold) {
        let dx = ncx - px;
        let dy = ncy - py;
        const mag = Math.hypot(dx, dy) || 1;
  
        let nl = (nr.left - zr.left) + (dx / mag) * 130;
        let nt = (nr.top - zr.top) + (dy / mag) * 130;
  
        nl = Math.max(10, Math.min(nl, zr.width - nr.width - 10));
        nt = Math.max(10, Math.min(nt, zr.height - nr.height - 10));
  
        noBtn.style.left = nl + 'px';
        noBtn.style.top = nt + 'px';
        noBtn.style.transform = `translateY(-50%) rotate(${Math.random() * 18 - 9}deg)`;
  
        growYes();
      }
  
      setTimeout(() => { isMoving = false; }, 30);
    }
  
    let animFrame = null;
  
    zone.addEventListener('mousemove', (e) => {
      if (animFrame) return;
      animFrame = requestAnimationFrame(() => {
        moveNo(e.clientX, e.clientY);
        animFrame = null;
      });
    });
  
    zone.addEventListener('touchmove', (e) => {
      if (!e.touches[0] || animFrame) return;
      const t = e.touches[0];
      animFrame = requestAnimationFrame(() => {
        moveNo(t.clientX, t.clientY);
        animFrame = null;
      });
    }, { passive: true });
  
    noBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const zr = zone.getBoundingClientRect();
  
      const left = 20 + Math.random() * (zr.width - noBtn.offsetWidth - 40);
      const top = 20 + Math.random() * (zr.height - noBtn.offsetHeight - 40);
  
      noBtn.style.left = left + 'px';
      noBtn.style.top = top + 'px';
      noBtn.style.transform = `translateY(-50%) rotate(${Math.random() * 18 - 9}deg)`;
  
      growYes();
    });
  
    // Yes click finale
    yesBtn.addEventListener('click', () => {
      zone.style.display = 'none';
      hint.style.display = 'none';
      result.style.display = 'block';
  
      const ci = confetti.create(document.getElementById('confettiCanvas'), { resize: true });
      ci({ particleCount: 150, spread: 100, origin: { y: 0.6 }, colors: ['#ff3b7a', '#ff7aa2', '#ffd6e7'] });
      setTimeout(() => ci({ particleCount: 100, spread: 120, origin: { y: 0.8 }, colors: ['#ff3b7a', '#ff7aa2'] }), 300);
  
      if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);
    });
  
    // Cursor hover feedback
    [yesBtn, noBtn].forEach(btn => {
      btn.addEventListener('mouseenter', () => cursor.classList.add('hovering'));
      btn.addEventListener('mouseleave', () => cursor.classList.remove('hovering'));
    });
  </script>
  
</body>
</html>
